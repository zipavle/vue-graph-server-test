{"version":3,"sources":["webpack:///webpack/bootstrap 66021f10e881cf625123","webpack:///./server/index.js","webpack:///external \"express\"","webpack:///external \"body-parser\"","webpack:///external \"express-session\"","webpack:///external \"nuxt\"","webpack:///external \"jsonwebtoken\"","webpack:///./graphClient.js","webpack:///external \"axios\"","webpack:///./../secrets.js","webpack:///./nuxt.config.js"],"names":["express","require","bodyParser","session","Nuxt","Builder","jwt","graphClient","secrets","app","host","process","env","HOST","port","PORT","set","use","json","secret","resave","saveUninitialized","cookie","maxAge","post","req","res","next","console","log","body","username","password","user","mutation","header","authorization","id","then","Promise","resolve","reject","token","verify","loginData","login","regenerate","sign","userId","sessionId","newToken","setSessionIdData","setSessionId","isSaved","name","email","catch","s","msg","config","dev","nuxt","builder","build","render","listen","url","method","query","options","axios","Object","assign","data","err","module","exports","jwtAlgorithm","head","title","meta","charset","content","hid","link","rel","type","href","css","vendor","modules","apollo","clientConfigs","default"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 66021f10e881cf625123","const express = require('express');\r\nconst bodyParser = require('body-parser');\r\nconst session = require('express-session');\r\nconst { Nuxt, Builder } = require('nuxt');\r\nconst jwt = require('jsonwebtoken');\r\nconst graphClient = require('../graphClient');\r\nconst secrets = require('../../secrets');\r\n\r\n// setup up server variables\r\nconst app = express();\r\nconst host = process.env.HOST || 'localhost';\r\nconst port = process.env.PORT || 3000;\r\n\r\n/*\r\n** Express\r\n */\r\n// set up server\r\napp.set('port', port);\r\n\r\n// set middleware\r\napp.use(bodyParser.json());\r\napp.use(session({\r\n    secret: secrets.jwt,\r\n    resave: false,\r\n    saveUninitialized: false,\r\n    cookie: { maxAge: 60000 }\r\n}));\r\n\r\n\r\n/*\r\n** API\r\n */\r\napp.post('/api/login', (req, res, next) => {\r\n    console.log(req.session);\r\n    // TODO: send session id in header\r\n    const {username, password} = req.body;\r\n    let user = {};\r\n    // call login mutation and get token with user ID\r\n    graphClient.mutation(`{\r\n        login(username:\"${username}\", password:\"${password}\") {\r\n            token\r\n        }\r\n    }`, {header: {authorization: `Bearer ${req.session.id}`}})\r\n    // regenerate session and return new token with session id and user id\r\n    .then(loginData => {\r\n        return new Promise((resolve, reject) => {\r\n            const token = jwt.verify(loginData.login.token, secrets.jwt);\r\n            req.session.regenerate(err => {\r\n                resolve(jwt.sign({userId: token.id, sessionId: req.session.id}, secrets.jwt));\r\n            });\r\n        });\r\n    })\r\n    // call setSessionId mutation to save session id to user db\r\n    .then(newToken => {\r\n        return graphClient.mutation(`{\r\n            setSessionId(token:\"${newToken}\") {\r\n                isSaved\r\n                id\r\n                name\r\n                username\r\n                email\r\n            }\r\n        }`, {header: {authorization: `Bearer ${req.session.id}`}});\r\n    })\r\n    // return user to client\r\n    .then(setSessionIdData => {\r\n        if (setSessionIdData.setSessionId.isSaved) {\r\n            const {id, name, username, email} = setSessionIdData.setSessionId;\r\n            res.json({id, name, username, email});\r\n        } \r\n    })\r\n    // catch errors\r\n    .catch(err => {\r\n        res.json({s: 'error', msg: 'No user found'});\r\n    });\r\n});\r\n\r\n\r\n/*\r\n** NUXT\r\n */\r\n// Import and Set Nuxt.js options\r\nlet config = require('../nuxt.config.js');\r\nconfig.dev = !(process.env.NODE_ENV === 'production');\r\n\r\n// Init Nuxt.js\r\nconst nuxt = new Nuxt(config);\r\n\r\n// Build only in dev mode\r\nif (config.dev) {\r\n  const builder = new Builder(nuxt);\r\n  builder.build()\r\n}\r\n\r\n// Give nuxt middleware to express\r\napp.use(nuxt.render);\r\n\r\n// Listen the server\r\napp.listen(port, host);\r\nconsole.log('Server listening on ' + host + ':' + port);\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"express-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express-session\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 5\n// module chunks = 0","import axios from 'axios';\r\n\r\nconst config = {\r\n    url: 'http://localhost:4000/graphql',\r\n    method: 'post'\r\n};\r\n\r\nconst query = (query, options) => {\r\n    return new Promise((resolve, reject) => {\r\n        axios(Object.assign({}, {data: {query: 'query ' + query}}, config, options))\r\n            .then(res => {\r\n                resolve(res.data.data);\r\n            }).catch(err => {\r\n            reject(err);\r\n        });\r\n    });\r\n};\r\n\r\nconst mutation = (query, options) => {\r\n    return new Promise((resolve, reject) => {\r\n        axios(Object.assign({}, {data: {query: 'mutation ' + query}}, config, options))\r\n            .then(res => {\r\n                resolve(res.data.data);\r\n            }).catch(err => {\r\n            reject(err);\r\n        });\r\n    });\r\n};\r\n\r\nexport {query, mutation};\n\n\n// WEBPACK FOOTER //\n// ./graphClient.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 7\n// module chunks = 0","module.exports = {\r\n    jwt: 'sdk397ehsfG3$T',\r\n    jwtAlgorithm: 'RS256'\r\n};\n\n\n// WEBPACK FOOTER //\n// ./../secrets.js","module.exports = {\r\n  /*\r\n  ** Headers of the page\r\n  */\r\n  head: {\r\n    title: 'starter',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ]\r\n  },\r\n  /*\r\n  ** Global CSS\r\n  */\r\n  css: ['~/assets/css/main.css'],\r\n  /*\r\n  ** Add axios globally\r\n  */\r\n  build: {\r\n    vendor: ['axios']\r\n  },\r\n  /*\r\n  ** Modules\r\n  */\r\n  modules: ['@nuxtjs/apollo'],\r\n  apollo: {\r\n    clientConfigs: {\r\n      default: '~/apollo-client.js'\r\n    }\r\n  }\r\n};\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}